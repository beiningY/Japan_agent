import openai
import os
from dotenv import load_dotenv
import time
start_time = time.time()
load_dotenv(dotenv_path='.env')
from openai import OpenAI

client = OpenAI(api_key=os.getenv('GPT_API_KEY'))

"""with client.responses.stream(
    model="gpt-4o",
    instructions="你是一个领域专家，你的任务是根据用户的问题，结合增强检索后的相关知识，给出专业的回答",
    input="问题：当前监测显示：DO=3.4 mg/L，比昨日下降了 0.8 单位，pH=8.0，水温 28.5°C。请问是否需要立即调整供氧或循环策略？如果需要，应优先采取哪些操作？参考内容：片段1: 7月31日星期四，晴，气温23～31摄氏度。一号池正常运行。水温30.2摄氏度，pH7.42，氨氮0，亚硝酸盐0.5-1mg/L。循环运行。清理物理过滤器。二号池运转正常。水温30.7摄氏度，pH7.48，氨氮0，亚硝酸盐0-0.5。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1号池水质又有波动，故减少喂食。2号池昨日喂食量增加后水质稍有变差，故今日恢复之前投食量2200g。检查所有运转中设备，不漏水.不断气.没有断电风险。片段2: 保证几乎所有的生物载体被充分搅动起来，保证水力关系合理，使尽量多的生物载体处理流进生物滤池的水。图2刚刚放入的生物载体，白色；图3运行三个月后的生物载体，棕黄色。片段3: 7月16日星期三，雨，气温24～28摄氏度。一号池运转正常。水温28.7摄氏度，pH7.76，氨氮0，亚硝酸盐0。循环运行。清理物理过滤器。二号池运转正常。水温28.9摄氏度，pH7.84，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1，2号池喂食盘未有剩食，保持投食量至1200g，继续观察。两个水池分别添加石灰乳800mL。检查所有运转中设备，不漏水.不断气.没有断电风险。片段4: 还可以考虑在养殖后期，将淡化养殖的成虾，通过短暂的盐化养殖，起到增加食用口感，减少寄生虫的作用。（专利申请中。温度建议每日测试，温度变化会影响虾类的摄食活动和活力。一般最适温度为28~32摄氏度。在夏季大棚，水温一般能维持在30摄食左右，非常适合虾类生长。在关东地区，温度从11月份开始下降，至水温20摄氏度左右，虾类已减少进食，温度低于20摄氏度，每日约有5~10%的虾死亡。溶解氧至少需要保证在4.0mg/L以上，保证在5.0~8.0mg/L是最适的。溶解氧是保证虾存活最快速被反应的指标，这意味着如果溶解氧低于下限（通常是1.0mg/L）一小时甚至数分钟，会导致虾窒息死亡。溶解氧的监测使用溶解氧仪，使用较方便。但需考虑溶解氧降低时该如何提高溶解氧，特别在曝气充足情况下。本次养殖过程中溶解氧曾被监测到非常低（低于2.0mg/L）的数值，该数值一般认为会导致虾类死亡。本次采用更换使用大型曝气机和增加曝气盘数量解决。如果在养殖过程中发现溶解氧有持续降低的趋势，或者测得数值有异常，需要在不同点位，使用不同的溶解氧仪重复测量，确保测试数值准确。日常养殖的正常溶解氧过低可能是由于养殖密度过高、水体内耗氧微生物繁殖过于强烈造成，可以通过增加曝气盘，增加溶解氧效率如使用新的曝气盘或使用微纳米气泡技术甚至纯氧曝气解决。在工厂化养殖条件下，溶解氧被认为是一个需要被不间断监测的指标。从现有大型工厂化养殖的公开信息中看到，温度，溶解氧，甚至pH和盐度都被实时在线监测。片段5: 8月7日星期四，雨转晴，气温25～32摄氏度。一号池正常运行。水温31.3摄氏度，pH7.50，氨氮0，亚硝酸盐0.25-0.5。循环运行。清理物理过滤器。二号池运转正常水温31.4摄氏度，pH7.50，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：清洗1、2号池污水回流池。1号池水质恢复，恢复每天喂食1600g。2号池增加喂食量至3000g。搭建淡化池并运行。检查所有运转中设备，不漏水.不断气.没有断电风险。请务必说明参考了以下文件：操作日志, data/raw_data/japan_shrimp/循环水南美白对虾养殖系统设计及操作手册张驰v3.0.pdf") as stream:
    full_text = ""
    for event in stream:
        if event.type == "response.output_text.delta":
            # 拼接每一小段文本
            full_text += event.delta
            print(event.delta, end="", flush=True)
        elif event.type == "response.completed":
            print("\n--- Done ---")
    # 最终完整文本
    print("\nFinal text:", full_text)"""

"""response = client.responses.create(
    model="gpt-4o",
    instructions="你是一个领域专家，你的任务是根据用户的问题，结合增强检索后的相关知识，给出专业的回答",
    input="问题：当前监测显示：DO=3.4 mg/L，比昨日下降了 0.8 单位，pH=8.0，水温 28.5°C。请问是否需要立即调整供氧或循环策略？如果需要，应优先采取哪些操作？参考内容：片段1: 7月31日星期四，晴，气温23～31摄氏度。一号池正常运行。水温30.2摄氏度，pH7.42，氨氮0，亚硝酸盐0.5-1mg/L。循环运行。清理物理过滤器。二号池运转正常。水温30.7摄氏度，pH7.48，氨氮0，亚硝酸盐0-0.5。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1号池水质又有波动，故减少喂食。2号池昨日喂食量增加后水质稍有变差，故今日恢复之前投食量2200g。检查所有运转中设备，不漏水.不断气.没有断电风险。片段2: 保证几乎所有的生物载体被充分搅动起来，保证水力关系合理，使尽量多的生物载体处理流进生物滤池的水。图2刚刚放入的生物载体，白色；图3运行三个月后的生物载体，棕黄色。片段3: 7月16日星期三，雨，气温24～28摄氏度。一号池运转正常。水温28.7摄氏度，pH7.76，氨氮0，亚硝酸盐0。循环运行。清理物理过滤器。二号池运转正常。水温28.9摄氏度，pH7.84，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1，2号池喂食盘未有剩食，保持投食量至1200g，继续观察。两个水池分别添加石灰乳800mL。检查所有运转中设备，不漏水.不断气.没有断电风险。片段4: 还可以考虑在养殖后期，将淡化养殖的成虾，通过短暂的盐化养殖，起到增加食用口感，减少寄生虫的作用。（专利申请中。温度建议每日测试，温度变化会影响虾类的摄食活动和活力。一般最适温度为28~32摄氏度。在夏季大棚，水温一般能维持在30摄食左右，非常适合虾类生长。在关东地区，温度从11月份开始下降，至水温20摄氏度左右，虾类已减少进食，温度低于20摄氏度，每日约有5~10%的虾死亡。溶解氧至少需要保证在4.0mg/L以上，保证在5.0~8.0mg/L是最适的。溶解氧是保证虾存活最快速被反应的指标，这意味着如果溶解氧低于下限（通常是1.0mg/L）一小时甚至数分钟，会导致虾窒息死亡。溶解氧的监测使用溶解氧仪，使用较方便。但需考虑溶解氧降低时该如何提高溶解氧，特别在曝气充足情况下。本次养殖过程中溶解氧曾被监测到非常低（低于2.0mg/L）的数值，该数值一般认为会导致虾类死亡。本次采用更换使用大型曝气机和增加曝气盘数量解决。如果在养殖过程中发现溶解氧有持续降低的趋势，或者测得数值有异常，需要在不同点位，使用不同的溶解氧仪重复测量，确保测试数值准确。日常养殖的正常溶解氧过低可能是由于养殖密度过高、水体内耗氧微生物繁殖过于强烈造成，可以通过增加曝气盘，增加溶解氧效率如使用新的曝气盘或使用微纳米气泡技术甚至纯氧曝气解决。在工厂化养殖条件下，溶解氧被认为是一个需要被不间断监测的指标。从现有大型工厂化养殖的公开信息中看到，温度，溶解氧，甚至pH和盐度都被实时在线监测。片段5: 8月7日星期四，雨转晴，气温25～32摄氏度。一号池正常运行。水温31.3摄氏度，pH7.50，氨氮0，亚硝酸盐0.25-0.5。循环运行。清理物理过滤器。二号池运转正常水温31.4摄氏度，pH7.50，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：清洗1、2号池污水回流池。1号池水质恢复，恢复每天喂食1600g。2号池增加喂食量至3000g。搭建淡化池并运行。检查所有运转中设备，不漏水.不断气.没有断电风险。请务必说明参考了以下文件：操作日志, data/raw_data/japan_shrimp/循环水南美白对虾养殖系统设计及操作手册张驰v3.0.pdf"
)"""
completion = client.chat.completions.create(
    model="gpt-3.5-turbo",
    messages=[
        {"role": "developer", "content": "你是一个领域专家，你的任务是根据用户的问题，结合增强检索后的相关知识，给出专业的回答"},
        {
            "role": "user",
            "content": "问题：当前监测显示：DO=3.4 mg/L，比昨日下降了 0.8 单位，pH=8.0，水温 28.5°C。请问是否需要立即调整供氧或循环策略？如果需要，应优先采取哪些操作？参考内容：片段1: 7月31日星期四，晴，气温23～31摄氏度。一号池正常运行。水温30.2摄氏度，pH7.42，氨氮0，亚硝酸盐0.5-1mg/L。循环运行。清理物理过滤器。二号池运转正常。水温30.7摄氏度，pH7.48，氨氮0，亚硝酸盐0-0.5。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1号池水质又有波动，故减少喂食。2号池昨日喂食量增加后水质稍有变差，故今日恢复之前投食量2200g。检查所有运转中设备，不漏水.不断气.没有断电风险。片段2: 保证几乎所有的生物载体被充分搅动起来，保证水力关系合理，使尽量多的生物载体处理流进生物滤池的水。图2刚刚放入的生物载体，白色；图3运行三个月后的生物载体，棕黄色。片段3: 7月16日星期三，雨，气温24～28摄氏度。一号池运转正常。水温28.7摄氏度，pH7.76，氨氮0，亚硝酸盐0。循环运行。清理物理过滤器。二号池运转正常。水温28.9摄氏度，pH7.84，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：1，2号池喂食盘未有剩食，保持投食量至1200g，继续观察。两个水池分别添加石灰乳800mL。检查所有运转中设备，不漏水.不断气.没有断电风险。片段4: 还可以考虑在养殖后期，将淡化养殖的成虾，通过短暂的盐化养殖，起到增加食用口感，减少寄生虫的作用。（专利申请中。温度建议每日测试，温度变化会影响虾类的摄食活动和活力。一般最适温度为28~32摄氏度。在夏季大棚，水温一般能维持在30摄食左右，非常适合虾类生长。在关东地区，温度从11月份开始下降，至水温20摄氏度左右，虾类已减少进食，温度低于20摄氏度，每日约有5~10%的虾死亡。溶解氧至少需要保证在4.0mg/L以上，保证在5.0~8.0mg/L是最适的。溶解氧是保证虾存活最快速被反应的指标，这意味着如果溶解氧低于下限（通常是1.0mg/L）一小时甚至数分钟，会导致虾窒息死亡。溶解氧的监测使用溶解氧仪，使用较方便。但需考虑溶解氧降低时该如何提高溶解氧，特别在曝气充足情况下。本次养殖过程中溶解氧曾被监测到非常低（低于2.0mg/L）的数值，该数值一般认为会导致虾类死亡。本次采用更换使用大型曝气机和增加曝气盘数量解决。如果在养殖过程中发现溶解氧有持续降低的趋势，或者测得数值有异常，需要在不同点位，使用不同的溶解氧仪重复测量，确保测试数值准确。日常养殖的正常溶解氧过低可能是由于养殖密度过高、水体内耗氧微生物繁殖过于强烈造成，可以通过增加曝气盘，增加溶解氧效率如使用新的曝气盘或使用微纳米气泡技术甚至纯氧曝气解决。在工厂化养殖条件下，溶解氧被认为是一个需要被不间断监测的指标。从现有大型工厂化养殖的公开信息中看到，温度，溶解氧，甚至pH和盐度都被实时在线监测。片段5: 8月7日星期四，雨转晴，气温25～32摄氏度。一号池正常运行。水温31.3摄氏度，pH7.50，氨氮0，亚硝酸盐0.25-0.5。循环运行。清理物理过滤器。二号池运转正常水温31.4摄氏度，pH7.50，氨氮0，亚硝酸盐0。浓缩污水上清液返流系统工作正常，并清洗污水桶。清洗物理过滤器。每日关键点总结：清洗1、2号池污水回流池。1号池水质恢复，恢复每天喂食1600g。2号池增加喂食量至3000g。搭建淡化池并运行。检查所有运转中设备，不漏水.不断气.没有断电风险。请务必说明参考了以下文件：操作日志, data/raw_data/japan_shrimp/循环水南美白对虾养殖系统设计及操作手册张驰v3.0.pdf",
        },
    ],
)

print(completion.choices[0].message.content)
end_time = time.time()
print(f"openai响应时间: {end_time - start_time}秒")

