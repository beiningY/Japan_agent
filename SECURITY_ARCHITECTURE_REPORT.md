# ğŸ”’ å®‰å…¨æ¶æ„éªŒè¯æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æŠ¥å‘ŠéªŒè¯äº†Camel_agenté¡¹ç›®ä¸­DataAgentå’ŒToolOrchestratorçš„å®‰å…¨æ¶æ„ï¼Œç¡®ä¿å·¥å…·è°ƒç”¨ç»è¿‡é›†ä¸­çš„å®‰å…¨å®¡æŸ¥ï¼Œå®ç°äº†agentä¸å·¥å…·è°ƒç”¨çš„è§£è€¦ã€‚

## ğŸ—ï¸ æœ€ç»ˆæ¶æ„

### æ ¸å¿ƒç»„ä»¶å±‚æ¬¡
```
ç”¨æˆ·è¯·æ±‚
    â†“
DataAgent (ç»§æ‰¿ MCPToolCallAgent)
    â†“ å·¥å…·è°ƒç”¨è¯·æ±‚
ToolRegistry (é›†ä¸­å®‰å…¨å®¡æŸ¥)
    â†“ å®¡æŸ¥é€šè¿‡å
MCP Tools (å®é™…æ‰§è¡Œ)
```

### æ–‡ä»¶ç»“æ„
```
Camel_agent/
â”œâ”€â”€ agents/
â”‚   â”œâ”€â”€ data_agent.py              # æ•°æ®åˆ†æAgent (ç»§æ‰¿MCPToolCallAgent)
â”‚   â”œâ”€â”€ mcp_toolcall_agent.py      # é€šç”¨å·¥å…·è°ƒç”¨Agent
â”‚   â””â”€â”€ react_agent.py             # ReActåŸºç¡€æ¡†æ¶
â”œâ”€â”€ ToolOrchestrator/
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ registry.py            # å·¥å…·æ³¨å†Œè¡¨ (é›†ä¸­å®‰å…¨å®¡æŸ¥)
â”‚   â”‚   â””â”€â”€ security.py            # å®‰å…¨éªŒè¯å™¨ (ç»Ÿä¸€å®‰å…¨é€»è¾‘)
â”‚   â””â”€â”€ tools/
â”‚       â”œâ”€â”€ permissions.json       # æƒé™é…ç½®
â”‚       â””â”€â”€ config.json            # å·¥å…·é…ç½®
â””â”€â”€ tests/
    â”œâ”€â”€ test_data_agent_integration.py  # é›†æˆæµ‹è¯•
    â”œâ”€â”€ test_security_validation.py     # å®‰å…¨æµ‹è¯•
    â””â”€â”€ run_tests.py                    # æµ‹è¯•è¿è¡Œå™¨
```

## âœ… å®‰å…¨æœºåˆ¶éªŒè¯

### 1. æƒé™æ§åˆ¶ç³»ç»Ÿ

**å¤šå±‚æƒé™æ£€æŸ¥**ï¼š
- âœ… **Agentçº§æƒé™**: æ¯ä¸ªagentæœ‰æ˜ç¡®çš„allowed_toolså’Œrestricted_tools
- âœ… **ç”¨æˆ·çº§æƒé™**: æ”¯æŒLOW/MEDIUM/HIGHä¸‰çº§æƒé™æ§åˆ¶
- âœ… **å·¥å…·é£é™©è¯„çº§**: å·¥å…·æŒ‰é£é™©çº§åˆ«åˆ†ç±»ç®¡æ§

**æƒé™é…ç½®ç¤ºä¾‹**ï¼š
```json
{
  "agents": {
    "data-agent": {
      "allowed_tools": ["list_sql_tables", "retrieve", "read_sql_query"],
      "restricted_tools": ["delete_collection"],
      "clearance_level": "MEDIUM"
    }
  }
}
```

### 2. è¾“å…¥éªŒè¯å®‰å…¨

**SQLæ³¨å…¥é˜²æŠ¤**ï¼š
```python
# âœ… å…è®¸: SELECTæŸ¥è¯¢
validator.validate_sql_query("SELECT * FROM users") â†’ True

# âŒ æ‹’ç»: å±é™©æ“ä½œ
validator.validate_sql_query("DROP TABLE users") â†’ False
```

**è·¯å¾„éå†é˜²æŠ¤**ï¼š
```python
# âœ… å…è®¸: ç›¸å¯¹è·¯å¾„
validator.validate_file_path("data/report.txt") â†’ True

# âŒ æ‹’ç»: è·¯å¾„éå†
validator.validate_file_path("../../../etc/passwd") â†’ False
```

### 3. é›†ä¸­å®‰å…¨å®¡æŸ¥

**ToolRegistryå®‰å…¨åŒ…è£…**ï¼š
```python
def _create_secure_handler(self, tool_name: str):
    async def secure_handler(*args, **kwargs):
        # 1. æƒé™æ£€æŸ¥
        security_result = security_validator.validate_agent_tool_access(...)

        # 2. è¾“å…¥éªŒè¯ (SQL/æ–‡ä»¶è·¯å¾„ç­‰)
        if tool_name == "read_sql_query":
            sql_result = security_validator.validate_sql_query(...)

        # 3. æ‰§è¡Œå·¥å…·
        return await self._create_mcp_handler(tool_name)(**clean_kwargs)
```

## ğŸ§ª æµ‹è¯•éªŒè¯ç»“æœ

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
```bash
ğŸ”’ æµ‹è¯•å®‰å…¨éªŒè¯å™¨...
   æƒé™æ£€æŸ¥: False - æƒé™çº§åˆ«ä¸è¶³: éœ€è¦MEDIUMï¼Œå½“å‰LOW  âœ…
   SQLå®‰å…¨æ£€æŸ¥: True - SQLæŸ¥è¯¢å®‰å…¨æ£€æŸ¥é€šè¿‡           âœ…
   å±é™©SQLæ£€æŸ¥: False - åªå…è®¸SELECTæŸ¥è¯¢           âœ…
   è·¯å¾„éå†æ£€æŸ¥: False - æ£€æµ‹åˆ°è·¯å¾„éå†æ”»å‡»          âœ…

ğŸ¤– æµ‹è¯•DataAgent...
   DataAgentåˆ›å»ºæˆåŠŸ: data-agent                  âœ…
   ç³»ç»Ÿæç¤º: ä½ æ˜¯æ•°æ®è·å–ä¸åˆ†æåŠ©æ‰‹...              âœ…
```

### æ¶æ„éªŒè¯é€šè¿‡é¡¹ç›®
- âœ… **ä»£ç ç»“æ„å®Œæ•´**: æ‰€æœ‰å¿…è¦æ–‡ä»¶å­˜åœ¨
- âœ… **æ¨¡å—å¯¼å…¥æ­£å¸¸**: æ ¸å¿ƒç»„ä»¶å¯æ­£å¸¸åŠ è½½
- âœ… **æƒé™é…ç½®æ­£ç¡®**: data-agentæƒé™é…ç½®åˆç†
- âœ… **å®‰å…¨éªŒè¯æœ‰æ•ˆ**: SQLæ³¨å…¥ã€è·¯å¾„éå†é˜²æŠ¤å·¥ä½œæ­£å¸¸
- âœ… **Agentç»§æ‰¿æ­£ç¡®**: DataAgent â†’ MCPToolCallAgent â†’ ReActAgent

## ğŸ¯ è®¾è®¡åŸåˆ™å®ç°

### 1. èŒè´£åˆ†ç¦» âœ…
- **Agent**: åªè´Ÿè´£ä¸šåŠ¡é€»è¾‘å’ŒLLMäº¤äº’
- **ToolOrchestrator**: è´Ÿè´£æ‰€æœ‰å®‰å…¨å®¡æŸ¥å’Œå·¥å…·ç®¡ç†
- **SecurityValidator**: ç»Ÿä¸€çš„å®‰å…¨éªŒè¯é€»è¾‘

### 2. è§£è€¦è®¾è®¡ âœ…
- Agentä¸çŸ¥é“å…·ä½“çš„å®‰å…¨è§„åˆ™
- å®‰å…¨è§„åˆ™é›†ä¸­åœ¨ToolOrchestratorä¸­ç®¡ç†
- æƒé™é…ç½®å¤–éƒ¨åŒ–ï¼Œæ˜“äºä¿®æ”¹

### 3. ç®€æ´æ€§ âœ…
- åˆ é™¤äº†é‡å¤çš„å®‰å…¨æ£€æŸ¥ä»£ç 
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æ ¼å¼
- æ¸…æ™°çš„ç»§æ‰¿å±‚æ¬¡

## ğŸ›¡ï¸ å®‰å…¨ä¿éšœ

### é˜²æŠ¤æªæ–½
1. **SQLæ³¨å…¥é˜²æŠ¤**: åªå…è®¸SELECTè¯­å¥ï¼Œæ£€æŸ¥å±é™©å…³é”®è¯
2. **è·¯å¾„éå†é˜²æŠ¤**: æ£€æŸ¥".."å’Œç»å¯¹è·¯å¾„
3. **æƒé™æ§åˆ¶**: å¤šå±‚æƒé™éªŒè¯
4. **è¾“å…¥éªŒè¯**: ç±»å‹æ£€æŸ¥å’Œæ ¼å¼éªŒè¯
5. **é”™è¯¯å¤„ç†**: å®‰å…¨çš„é”™è¯¯ä¿¡æ¯è¿”å›

### å®¡è®¡åŠŸèƒ½
- æ‰€æœ‰å®‰å…¨æ£€æŸ¥éƒ½æœ‰æ—¥å¿—è®°å½•
- æƒé™æ‹’ç»äº‹ä»¶è¢«è®°å½•
- æ”¯æŒæƒé™é…ç½®çš„åŠ¨æ€åˆ·æ–°

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

1. **æƒé™ç¼“å­˜**: é¿å…é‡å¤è¯»å–é…ç½®æ–‡ä»¶
2. **å¿«é€Ÿå¤±è´¥**: æƒé™æ£€æŸ¥å¤±è´¥æ—¶ç«‹å³è¿”å›
3. **å‚æ•°æ¸…ç†**: ç»Ÿä¸€çš„å†…éƒ¨å‚æ•°è¿‡æ»¤
4. **è¿æ¥å¤ç”¨**: ä½¿ç”¨å…¨å±€å·¥å…·ç®¡ç†å™¨

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. åŸºç¡€ä½¿ç”¨
```python
from agents.data_agent import DataAgent

# åˆ›å»ºDataAgent (è‡ªåŠ¨ç»§æ‰¿å®‰å…¨æœºåˆ¶)
agent = DataAgent()

# è¿è¡ŒæŸ¥è¯¢ (ä¼šè‡ªåŠ¨ç»è¿‡å®‰å…¨å®¡æŸ¥)
result = await agent.run("è¯·æŸ¥è¯¢æ•°æ®åº“ä¸­çš„ç”¨æˆ·è¡¨ç»“æ„")
```

### 2. æƒé™é…ç½®
```json
// åœ¨ ToolOrchestrator/tools/permissions.json ä¸­é…ç½®
{
  "agents": {
    "your-agent": {
      "allowed_tools": ["list_sql_tables", "retrieve"],
      "clearance_level": "MEDIUM"
    }
  }
}
```

### 3. æ·»åŠ æ–°å·¥å…·
æ–°å·¥å…·ä¼šè‡ªåŠ¨ç»§æ‰¿å®‰å…¨å®¡æŸ¥æœºåˆ¶ï¼Œåªéœ€åœ¨é…ç½®æ–‡ä»¶ä¸­å£°æ˜å³å¯ã€‚

## âœ… ç»“è®º

**æ¶æ„è®¾è®¡æˆåŠŸå®ç°äº†ä»¥ä¸‹ç›®æ ‡**ï¼š

1. âœ… **é›†ä¸­å®‰å…¨å®¡æŸ¥**: æ‰€æœ‰å·¥å…·è°ƒç”¨éƒ½ç»è¿‡ToolOrchestratorå®¡æŸ¥
2. âœ… **Agentå·¥å…·è§£è€¦**: Agentä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œä¸å…³å¿ƒå®‰å…¨ç»†èŠ‚
3. âœ… **ä»£ç ç®€æ´æ€§**: åˆ é™¤é‡å¤ä»£ç ï¼Œç»Ÿä¸€å®‰å…¨é€»è¾‘
4. âœ… **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æƒé™ç®¡ç†
5. âœ… **å‘åå…¼å®¹**: ç°æœ‰DataAgentæ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨

**å®‰å…¨æ€§å¾—åˆ°æ˜¾è‘—æå‡**ï¼š
- SQLæ³¨å…¥é˜²æŠ¤ âœ…
- è·¯å¾„éå†é˜²æŠ¤ âœ…
- æƒé™æ§åˆ¶ âœ…
- è¾“å…¥éªŒè¯ âœ…
- å®¡è®¡æ—¥å¿— âœ…

ç³»ç»Ÿç°åœ¨å…·å¤‡äº†ç”Ÿäº§çº§åˆ«çš„å®‰å…¨ä¿éšœï¼Œå¯ä»¥å®‰å…¨åœ°ç”¨äºå¤šagentç¯å¢ƒä¸­çš„å·¥å…·è°ƒç”¨ã€‚